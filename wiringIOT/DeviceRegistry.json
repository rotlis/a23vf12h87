[
  {
    "id": "292dc006.7cf3f",
    "type": "udp in",
    "z": "a9a9f52d.775198",
    "name": "",
    "iface": "",
    "port": "9001",
    "ipv": "udp4",
    "multicast": "false",
    "group": "",
    "datatype": "utf8",
    "x": 142,
    "y": 80,
    "wires": [
      [
        "f94f6342.41601"
      ]
    ]
  },
  {
    "id": "f94f6342.41601",
    "type": "function",
    "z": "a9a9f52d.775198",
    "name": "prepare entry",
    "func": "mac = msg.payload.substring(0, msg.payload.indexOf(':'));\nmsg.payload = {\n    'ip':msg.ip,\n    'port':msg.port,\n    'pipeline':'',\n    'lastMessage':msg.payload.substring(msg.payload.indexOf(':')+1),\n    'lastSeen':new Date()\n};\nmsg.datapath = '/devices/' + mac;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 470,
    "y": 80,
    "wires": [
      [
        "4ffba2fb.b6d82c"
      ]
    ]
  },
  {
    "id": "4ffba2fb.b6d82c",
    "type": "DataIn",
    "z": "a9a9f52d.775198",
    "collection": "cec35a48.377fe8",
    "name": "save DB",
    "update": false,
    "path": "/",
    "x": 739,
    "y": 80,
    "wires": []
  },
  {
    "id": "cefa1ae5.e53908",
    "type": "http in",
    "z": "a9a9f52d.775198",
    "name": "",
    "url": "/devices",
    "method": "get",
    "swaggerDoc": "",
    "x": 151,
    "y": 280,
    "wires": [
      [
        "99020f37.12ed9"
      ]
    ]
  },
  {
    "id": "99020f37.12ed9",
    "type": "DataOut",
    "z": "a9a9f52d.775198",
    "collection": "cec35a48.377fe8",
    "name": "load DB",
    "path": "/",
    "error": false,
    "x": 359,
    "y": 280,
    "wires": [
      [
        "8c703083.d3902"
      ]
    ]
  },
  {
    "id": "8c703083.d3902",
    "type": "function",
    "z": "a9a9f52d.775198",
    "name": "HTTP headers",
    "func": "msg.headers={'Content-type':'application/json'}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 560,
    "y": 280,
    "wires": [
      [
        "494cbba6.2fa6b4"
      ]
    ]
  },
  {
    "id": "494cbba6.2fa6b4",
    "type": "http response",
    "z": "a9a9f52d.775198",
    "name": "",
    "x": 749,
    "y": 280,
    "wires": []
  },
  {
    "id": "9ab3c7cc.3e8cb8",
    "type": "comment",
    "z": "a9a9f52d.775198",
    "name": "Process UDP beakon from device",
    "info": "",
    "x": 153,
    "y": 23,
    "wires": []
  },
  {
    "id": "a3e5a9df.4f3c18",
    "type": "comment",
    "z": "a9a9f52d.775198",
    "name": "REST GET all devices",
    "info": "",
    "x": 113,
    "y": 230,
    "wires": []
  },
  {
    "id": "5482004.726d9",
    "type": "comment",
    "z": "a9a9f52d.775198",
    "name": "Clear DB",
    "info": "",
    "x": 73,
    "y": 351,
    "wires": []
  },
  {
    "id": "bbd09347.36e84",
    "type": "inject",
    "z": "a9a9f52d.775198",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "x": 166,
    "y": 400,
    "wires": [
      [
        "d6957f1c.5c017"
      ]
    ]
  },
  {
    "id": "e142e3ca.757a",
    "type": "DataIn",
    "z": "a9a9f52d.775198",
    "collection": "cec35a48.377fe8",
    "name": "save DB",
    "update": false,
    "path": "/",
    "x": 739,
    "y": 400,
    "wires": []
  },
  {
    "id": "d6957f1c.5c017",
    "type": "function",
    "z": "a9a9f52d.775198",
    "name": "empty payload",
    "func": "msg.payload={};\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 441,
    "y": 400,
    "wires": [
      [
        "e142e3ca.757a"
      ]
    ]
  },
  {
    "id": "28b92e68.e72a12",
    "type": "comment",
    "z": "a9a9f52d.775198",
    "name": "Send 'tickle' UDP to all devices",
    "info": "",
    "x": 137,
    "y": 481,
    "wires": []
  },
  {
    "id": "fb00d95d.714688",
    "type": "inject",
    "z": "a9a9f52d.775198",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "x": 166,
    "y": 522,
    "wires": [
      [
        "653ea52c.7459ac"
      ]
    ]
  },
  {
    "id": "653ea52c.7459ac",
    "type": "DataOut",
    "z": "a9a9f52d.775198",
    "collection": "cec35a48.377fe8",
    "name": "load DB",
    "path": "/",
    "error": false,
    "x": 321,
    "y": 522,
    "wires": [
      [
        "cc9777c.cc09788"
      ]
    ]
  },
  {
    "id": "2fb11d6f.4982e2",
    "type": "udp out",
    "z": "a9a9f52d.775198",
    "name": "",
    "addr": "",
    "iface": "",
    "port": "",
    "ipv": "udp4",
    "outport": "",
    "base64": false,
    "multicast": "false",
    "x": 672,
    "y": 591,
    "wires": []
  },
  {
    "id": "cc9777c.cc09788",
    "type": "function",
    "z": "a9a9f52d.775198",
    "name": "iterate through all device and send them black color",
    "func": "for(var mac in msg.payload){\n    var dev = msg.payload[mac];\n    var tickleMessage = {\n        'ip':dev.ip, \n        'port':dev.port,\n        'payload':'black'\n    };\n    node.send(tickleMessage);\n}\n// drop original message\nreturn null;",
    "outputs": 1,
    "noerr": 0,
    "x": 621,
    "y": 522,
    "wires": [
      [
        "2fb11d6f.4982e2"
      ]
    ]
  },
  {
    "id": "2ba5bdc7.880462",
    "type": "http in",
    "z": "a9a9f52d.775198",
    "name": "Assign pipeline to Device",
    "url": "/devices",
    "method": "post",
    "swaggerDoc": "",
    "x": 190,
    "y": 161,
    "wires": [
      [
        "2b157096.126f5"
      ]
    ]
  },
  {
    "id": "dd63c95b.958178",
    "type": "DataIn",
    "z": "a9a9f52d.775198",
    "collection": "cec35a48.377fe8",
    "name": "save DB",
    "update": false,
    "path": "/",
    "x": 739,
    "y": 161,
    "wires": []
  },
  {
    "id": "2b157096.126f5",
    "type": "function",
    "z": "a9a9f52d.775198",
    "name": "prepare entry",
    "func": "msg.datapath = '/devices/' + msg.payload.mac + '/pipeline';\nmsg.payload = msg.payload.pipelineName;\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 469,
    "y": 161,
    "wires": [
      [
        "dd63c95b.958178"
      ]
    ]
  },
  {
    "id": "cec35a48.377fe8",
    "type": "json-db-collection",
    "z": "a9a9f52d.775198",
    "name": "bbl",
    "collection": "devices",
    "save": true
  }
]